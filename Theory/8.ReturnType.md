-- Controller Action Return Types in ASP.NET Core Web API --
- Trong ASP.NET Core Web API, các action của controller có thể trả về nhiều loại phản hồi khác nhau tùy theo yêu cầu cụ thể của từng endpoint để xử lý các tình huống khác nhau và cung cấp sự linh hoạt trong cách gửi phản hồi đến client.
- Việc lựa chọn kiểu trả về phù hợp là rất quan trọng để quản lý phản hồi HTTP hiệu quả, đảm bảo tính an toàn kiểu (type safety) và nâng cao chất lượng tài liệu API.
- Trong ASP.NET Core Web API, các phương thức action của controller có thể trả về nhiều loại giá trị để quản lý phản hồi HTTP một cách hiệu quả. Các kiểu trả về chính bao gồm:
  1. Kiểu dữ liệu nguyên thủy hoặc phức tạp (Primitive or Complex Types)
  2. IActionResult
  3. ActionResult<T>
  4. Các kiểu kết quả cụ thể (Specific Result Types)

Task<IActionResult> hoặc Task<ActionResult<T>> (cho các action bất đồng bộ)

1. Returning Primitive Types
- Các kiểu nguyên thủy là các kiểu dữ liệu cơ bản như int, string, bool, v.v. Trả về một kiểu nguyên thủy từ action method sẽ tạo ra một giá trị JSON đơn giản trong phản hồi. 
2. Returning Complex Type
- Các kiểu phức tạp là các lớp tùy chỉnh chứa nhiều thuộc tính. Trả về một kiểu phức tạp sẽ tuần tự hóa toàn bộ đối tượng thành một đối tượng JSON. Bây giờ, hãy xem cách trả về dữ liệu employee phức tạp bằng action method của controller. 
3. Returning Collections
- Bạn có thể trả về các collection của kiểu phức tạp, chẳng hạn như List<Employee> hoặc IEnumerable<Employee>, sẽ được tuần tự hóa thành mảng JSON.
4. Alternative Return Type:
- Thay vì List<Employee>, bạn có thể sử dụng IEnumerable<Employee> để linh hoạt hơn. 

-- Primitive or Complex Types Limitations: --
- Khi phản hồi đơn giản và dễ đoán, chẳng hạn như trả về một giá trị hoặc một đối tượng dữ liệu đơn giản. Ví dụ: Trả về kết quả tính toán (như một số hoặc chuỗi) hoặc một đối tượng nhỏ, nhất quán. Tuy nhiên, cách này có những hạn chế sau:
  1. Lack of Control Over Status Code: Không thể thiết lập rõ ràng mã trạng thái HTTP, vì phản hồi mặc định là 200 OK.
  2. No Error Handling Built-In: Không hỗ trợ trả về mã lỗi hoặc các siêu dữ liệu bổ sung như tiêu đề (headers) trừ khi được bọc trong một đối tượng tùy chỉnh hoặc cơ chế khác.
  3. Limited Flexibility: Không phù hợp với các tình huống cần trả về nhiều loại phản hồi khác nhau (ví dụ: thành công, lỗi hoặc thất bại trong kiểm tra hợp lệ).

-- IActionResult Return Type in ASP.NET Core Web API: --
- IActionResult là một interface cho phép các action trong controller trả về nhiều loại phản hồi HTTP một cách linh động. 
- Nó cung cấp tính linh hoạt cao hơn bằng cách cho phép các action trả về các mã trạng thái HTTP và kiểu phản hồi khác nhau dựa trên điều kiện thực thi. 
- Chúng ta sẽ nhận được các lợi ích sau khi sử dụng IActionResult:
  - Cho phép các action trả về các phản hồi HTTP khác nhau (ví dụ: Ok(), NotFound(), BadRequest()) từ một phương thức action duy nhất dựa trên điều kiện thực thi.
  - Cho phép các action kiểm soát chi tiết phản hồi, chẳng hạn như mã trạng thái, header và nội dung.
  - Với kiểu trả về là IActionResult, chúng ta có thể dễ dàng xử lý và trả về các phản hồi lỗi như StatusCode(500).

-- What is ProducesResponseType in ASP.NET Core Web API? --
- Thuộc tính ProducesResponseType trong ASP.NET Core Web API dùng để chỉ định loại phản hồi và mã trạng thái HTTP mà một action method có thể trả về. 
- Thuộc tính này rất hữu ích trong việc tài liệu hóa API một cách rõ ràng, giúp các nhà phát triển dễ dàng hiểu được các phản hồi có thể nhận được từ một endpoint.
- Thuộc tính ProducesResponseType có thể được áp dụng nhiều lần trên một action method để mô tả các phản hồi khác nhau. 
- Điều này đặc biệt hữu ích cho các công cụ như Swagger/OpenAPI để tự động tạo tài liệu API chính xác.

- Tác dụng của ProducesResponseType
  - Tài liệu hóa API: Giúp Swagger/OpenAPI hiển thị rõ ràng các phản hồi có thể xảy ra.
  - Tăng tính minh bạch: Client biết chính xác kiểu dữ liệu trả về và các mã lỗi có thể nhận được.
  - Hỗ trợ các công cụ phát triển: Các công cụ như Visual Studio IntelliSense hoặc Postman có thể dựa vào thông tin này để gợi ý hoặc validate.

- Hạn chế của IActionResult
  - Khi sử dụng IActionResult, ta có thể linh hoạt trả về nhiều loại HTTP status code khác nhau (200, 404, 500,...). Tuy nhiên, nó có một số hạn chế:
  - Không rõ ràng về kiểu dữ liệu trả về: Client phải tự đoán hoặc đọc tài liệu để biết kiểu dữ liệu trả về khi thành công (200 OK).
  - Khó khăn trong deserialization: Nếu không có ProducesResponseType, client không biết chắc chắn kiểu dữ liệu để deserialize.

-- ActionResult<T> Return Type in ASP.NET Core Web API: --
- ActionResult<T> là một kiểu trả về tổng quát (generic) kết hợp tính linh hoạt của IActionResult với tính an toàn kiểu (type safety) khi trả về một kiểu dữ liệu cụ thể (T).
- Nó cho phép chúng ta trả về một ActionResult hoặc một kiểu dữ liệu cụ thể (T) từ các action trong controller.
- Điều này có nghĩa là chúng ta có thể trả về các phản hồi HTTP tiêu chuẩn như NotFound(), BadRequest(), hoặc một kiểu dữ liệu cụ thể khi thao tác thành công. Dưới đây là những lợi ích khi sử dụng ActionResult<T>:
  - Type Safety: Cung cấp phản hồi được kiểm tra kiểu chặt chẽ, giúp tăng khả năng đọc và bảo trì mã.
  - Linh hoạt (Flexibility): Cho phép trả về cả dữ liệu cụ thể (T) hoặc các mã trạng thái HTTP khác nhau (ActionResult), chẳng hạn như NotFound(), BadRequest(), v.v.
  - Tài liệu hóa tốt hơn (Enhanced Documentation): Cải thiện tài liệu API bằng cách khai báo rõ ràng cả model dữ liệu và các kết quả action tiềm năng.

-- Specific Result Types in ASP.NET Core Web API --
- Trong ASP.NET Core, các loại kết quả cụ thể là các lớp triển khai giao diện IActionResult. 
- Chúng đại diện cho các phản hồi HTTP cụ thể với mã trạng thái được định nghĩa sẵn và (tùy chọn) nội dung phản hồi.
- Điều này cho phép lập trình viên trả về các mã trạng thái và dữ liệu cụ thể. 
- Các loại kết quả phổ biến bao gồm:
1. OkResult và OkObjectResult
  - OkResult: Trả về mã trạng thái 200 OK mà không có nội dung. Phù hợp khi bạn muốn thông báo thành công nhưng không cần trả về dữ liệu.
  - OkObjectResult: Trả về mã trạng thái 200 OK kèm theo nội dung phản hồi. Sử dụng khi bạn muốn trả về dữ liệu cùng với trạng thái thành công.
2. NotFoundResult và NotFoundObjectResult
  - NotFoundResult: Trả về mã trạng thái 404 Not Found mà không có nội dung. Hữu ích khi tài nguyên yêu cầu không tồn tại.
  - NotFoundObjectResult: Trả về mã trạng thái 404 Not Found kèm theo nội dung phản hồi, thường là thông báo hoặc chi tiết giải thích lý do tài nguyên không được tìm thấy.
3. BadRequestResult và BadRequestObjectResult
  - BadRequestResult: Trả về mã trạng thái 400 Bad Request mà không có nội dung. Cho biết yêu cầu không hợp lệ hoặc bị sai cú pháp.
  - BadRequestObjectResult: Trả về mã trạng thái 400 Bad Request kèm theo nội dung phản hồi chứa thông tin lỗi, giúp phía client hiểu được vấn đề.
4. StatusCodeResult
  - Cho phép trả về bất kỳ mã trạng thái HTTP nào, có hoặc không kèm theo dữ liệu.
5. CreatedAtActionResult
  - Trả về mã trạng thái 201 Created và bao gồm tiêu đề Location trỏ đến tài nguyên mới được tạo. Thường được sử dụng trong các phương thức POST khi tạo một tài nguyên mới.
6. NoContentResult
  - Trả về mã trạng thái 204 No Content, cho biết hành động thành công nhưng không có thông tin bổ sung để trả về.

-- Why Use IActionResult or ActionResult<T> Instead of Specific Result Types Directly? --
- Một phương thức action có thể cần trả về các phản hồi HTTP khác nhau dựa trên logic nghiệp vụ (ví dụ: 200 OK, 404 Not Found, 400 Bad Request). 
- Nếu bạn trả về một kiểu kết quả cụ thể (ví dụ: OkObjectResult), bạn sẽ giới hạn phương thức đó chỉ trả về một loại phản hồi duy nhất, trừ khi bạn thay đổi kiểu trả về hoặc sử dụng ép kiểu, điều này sẽ làm phức tạp mã nguồn.
- Trong ví dụ dưới đây, phương thức có thể trả về NotFoundObjectResult hoặc OkObjectResult tùy thuộc vào việc có tồn tại nhân viên hay không. Nếu bạn chỉ trả về một kiểu kết quả cụ thể trực tiếp (ví dụ: luôn trả về OkObjectResult), bạn sẽ mất khả năng trả về các phản hồi khác nhau mà không cần thay đổi kiểu trả của phương thức, và bạn sẽ gặp lỗi khi biên dịch như trong hình dưới đây:

-- Asynchronous Return Types in ASP.NET Core Web API: --
- Lập trình bất đồng bộ là yếu tố thiết yếu để xây dựng các ứng dụng web có khả năng mở rộng. 
- ASP.NET Core hỗ trợ các phương thức action bất đồng bộ bằng cách sử dụng các kiểu trả về như Task<IActionResult> và Task<ActionResult<T>>.
- Điều này cho phép các phương thức action của chúng ta thực hiện các thao tác bất đồng bộ và trả về các phản hồi đa dạng.
1. Task<IActionResult> Return Type 
- Trong ASP.NET Core Web API, Task<IActionResult> được sử dụng cho các phương thức action bất đồng bộ trả về các phản hồi HTTP khác nhau. 
- Cách tiếp cận này thường được sử dụng khi phương thức action thực hiện các thao tác bất đồng bộ.
- Nó kết hợp hai khái niệm: Task cho lập trình bất đồng bộ và IActionResult cho các phản hồi HTTP linh hoạt.
- Sự kết hợp này hữu ích khi yêu cầu các thao tác I/O không chặn (non-blocking), chẳng hạn như khi làm việc với các dịch vụ web bên ngoài, cơ sở dữ liệu hoặc hệ thống tệp. Dựa trên các điều kiện thời gian chạy, phương thức action muốn trả về các phản hồi HTTP khác nhau (Ok, NotFound, BadRequest, v.v.).

-- When Should We Use Which Return Type in ASP.NET Core Web API? --
- Việc chọn loại giá trị trả về phù hợp phụ thuộc vào yêu cầu cụ thể của phương thức action:
1. Kiểu dữ liệu nguyên thủy hoặc phức tạp (Primitive/Complex Types):
  - Sử dụng khi cần phản hồi đơn giản, trực tiếp mà không yêu cầu kiểm soát chi tiết phản hồi.
2. IActionResult:
  - Dùng khi cần trả về nhiều loại phản hồi khác nhau (ví dụ: thành công, lỗi, không tìm thấy) từ cùng một phương thức action.
3. ActionResult<T>:
  - Dùng khi cần trả về một kiểu dữ liệu cụ thể kèm theo khả năng linh hoạt trả về các mã trạng thái HTTP khác nhau. Cách này giúp tài liệu API rõ ràng hơn.
4. Các kiểu kết quả cụ thể (Specific Result Types):
  - Dùng khi muốn định rõ loại phản hồi, cho phép kiểm soát trực tiếp kiểu phản hồi và mã trạng thái.
5. Task<IActionResult> hoặc Task<ActionResult<T>>:
  - Dùng cho các phương thức action bất đồng bộ thực hiện các tác vụ I/O-bound như gọi database, thao tác file hoặc gọi dịch vụ bên ngoài.