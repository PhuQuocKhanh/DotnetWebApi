-- What is 503 HTTP Status Code? --
- Mã trạng thái HTTP 503 có nghĩa là “Service Unavailable” (Dịch vụ không khả dụng), cho biết máy chủ web hiện không thể xử lý yêu cầu. 
- Nguyên nhân có thể do máy chủ bị quá tải hoặc đang trong quá trình bảo trì. 
- Mã này cho thấy rằng máy chủ tạm thời không thể xử lý yêu cầu, nhưng có thể sẽ khả dụng trở lại trong tương lai.
- Thông thường, mã 503 được sử dụng để thông báo cho client biết rằng nên thử lại yêu cầu sau một khoảng thời gian. 
- Máy chủ có thể tùy chọn thêm header Retry-After trong phản hồi để chỉ định thời gian dịch vụ dự kiến không khả dụng. 
- Client có thể sử dụng thông tin này để quyết định thời điểm gửi lại yêu cầu.

-- 503 HTTP Status Code in ASP.NET Core Web API --
- Trong ứng dụng ASP.NET Core Web API, mã 503 thường biểu thị rằng dịch vụ API đang bị ngừng hoặc không thể xử lý yêu cầu tại thời điểm đó. Một số nguyên nhân phổ biến bao gồm:
1. Service Overload (Quá tải dịch vụ):
  - Khi máy chủ nhận quá nhiều request vượt quá khả năng xử lý, nó có thể bắt đầu từ chối một số request bằng mã 503. 
  - Điều này có thể xảy ra khi web server (ví dụ: IIS, Kestrel...) bị quá tải, thiếu tài nguyên hệ thống như CPU, RAM...
2. Maintenance Mode (Chế độ bảo trì):
  - Máy chủ có thể đang trong chế độ bảo trì – tạm ngừng hoạt động để cập nhật, nâng cấp hoặc triển khai thay đổi.
3. Dependency Issues (Sự cố với các phụ thuộc):
  - Nếu các dịch vụ phụ thuộc như cơ sở dữ liệu, API bên ngoài, message queue... không thể kết nối hoặc hoạt động bất thường, có thể gây lỗi 503 cho API của bạn.
4. Application Pool Issues (Sự cố với Application Pool):
  - Đối với môi trường chạy trên IIS, các sự cố như application pool bị crash, dừng hoặc bị vô hiệu hóa cũng có thể dẫn đến lỗi 503.
  
-- How to Troubleshoot 503 HTTP Status Code in ASP.NET Core Web API -- 
- Mã lỗi HTTP 503 Service Unavailable cho biết máy chủ tạm thời không thể xử lý yêu cầu, thường do quá tải, bảo trì hoặc lỗi từ các dịch vụ phụ thuộc. Để xử lý hiệu quả lỗi này trong ứng dụng ASP.NET Core, bạn cần kiểm tra các yếu tố sau: 

1. Kiểm tra tải của máy chủ (Server Load)
- Triệu chứng: CPU, RAM hoặc băng thông mạng bị quá tải khiến server không đáp ứng kịp các yêu cầu.
- Hành động khắc phục:
  - Theo dõi các chỉ số hệ thống bằng công cụ:
    - Windows: Performance Monitor (perfmon)
    - Cloud: Azure Monitor, AWS CloudWatch, Google Cloud Monitoring
  - Cân nhắc scale up (tăng cấu hình) hoặc scale out (tăng số lượng instance).
  - Triển khai rate limiting để giới hạn số lượng request tối đa trong một khoảng thời gian.
  - Cấu hình load balancer để phân phối đều lưu lượng truy cập đến các node khác nhau.

2. Chế độ bảo trì (Maintenance Mode)
- Triệu chứng: Ứng dụng hoặc một phần hệ thống đang được cập nhật, nâng cấp hoặc dừng hoạt động tạm thời.
- Hành động khắc phục:
  - Cài đặt middleware để trả về 503 khi bật chế độ bảo trì:
    - Hiển thị thông báo bảo trì thân thiện với người dùng.
    - Sử dụng trang thông báo trạng thái (status page) để thông báo công khai tình trạng hệ thống.

3. Vấn đề từ các dịch vụ phụ thuộc (Dependency Issues)
- Triệu chứng: API phụ thuộc vào các dịch vụ khác (cơ sở dữ liệu, Redis, API bên thứ ba, microservices...) đang gặp sự cố hoặc downtime.
- Hành động khắc phục:
  - Kiểm tra tình trạng các dịch vụ phụ thuộc.
  - Dùng các công cụ health check hoặc retry logic khi gọi đến các API/phụ trợ khác.
  - Đảm bảo không có giới hạn kết nối hoặc throttling từ phía dịch vụ đối tác.

4. Kiểm tra log ứng dụng (Application Logs)
- Triệu chứng: Lỗi 503 có thể là kết quả của một lỗi logic hoặc cấu hình sai trong ứng dụng.
- Hành động khắc phục:
  - Xem log lỗi để xác định nguyên nhân cụ thể.
  - Sử dụng các framework log mạnh như:
    - Serilog
    - NLog
    - ASP.NET Core built-in logging (ILogger)
  - Log lại status code, message, stack trace và thông tin về request để hỗ trợ debugging.

5. Cơ chế thử lại (Retry Mechanism)
- Triệu chứng: Một số lỗi 503 mang tính tạm thời (transient), có thể tự động phục hồi sau một thời gian ngắn.
- Hành động khắc phục:
  - Sử dụng thư viện Polly để cài đặt retry logic
  - Áp dụng với các HTTP request đến API ngoài hoặc các dịch vụ dễ gặp lỗi tạm thời.

6. Cân bằng tải (Load Balancing)
- Triệu chứng: Một số instance bị quá tải trong khi các instance khác rảnh rỗi.
- Hành động khắc phục:
  - Cài đặt load balancer như Nginx, HAProxy, hoặc sử dụng dịch vụ cloud như Azure Application Gateway, AWS ELB.
  - Đảm bảo cấu hình cân bằng tải đúng: Health checks, Sticky sessions, Round-robin, v.v.


