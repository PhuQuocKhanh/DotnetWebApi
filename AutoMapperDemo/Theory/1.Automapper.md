-- Automapper in ASP.NET Core Web API --
- Khi phát triển một ứng dụng ASP.NET Core Web API, chúng ta thường chia ứng dụng thành nhiều tầng, trong đó mỗi tầng có thể sử dụng các kiểu dữ liệu khác nhau để biểu diễn thông tin. Ví dụ:
  - Tầng Data (Data Layer) — thường sử dụng Entity Framework Core với các lớp entity (mô hình) phản ánh cấu trúc của cơ sở dữ liệu.
  - Tầng Application hoặc API Layer — sử dụng các lớp DTO (Data Transfer Object) để gửi dữ liệu phù hợp hơn với nhu cầu của client.
- Việc ánh xạ thủ công (manual mapping) giữa các lớp Model và DTO có thể trở nên tốn công và dễ xảy ra lỗi, đặc biệt khi hệ thống ngày càng mở rộng và số lượng thuộc tính gia tăng.
- AutoMapper là một thư viện mạnh mẽ trong ASP.NET Core giúp tự động ánh xạ giữa các đối tượng có cấu trúc tương tự. Đây là công cụ rất hữu ích trong các tình huống khi bạn cần chuyển đổi giữa các mô hình dữ liệu phức tạp mà không cần viết lại nhiều mã lặp đi lặp lại.
- AutoMapper giúp giảm đáng kể lượng mã ánh xạ thủ công, từ đó làm cho code trở nên sạch hơn, dễ bảo trì hơn và ít lỗi hơn.

-- What are Models (Entities)? --
- Trong ứng dụng ASP.NET Core Web API, model (hay còn gọi là entity) là các lớp đại diện cho cấu trúc dữ liệu trong cơ sở dữ liệu và thường ánh xạ trực tiếp tới các bảng trong database. 
- Chúng bao gồm đầy đủ các trường dữ liệu cần thiết để lưu trữ thông tin, kể cả những thuộc tính nội bộ hoặc nhạy cảm (ví dụ: SupplierCost, SupplierInfo, StockQuantity, SKU, Brand, hoặc các dấu thời gian trong entity Product) — những dữ liệu quan trọng cho logic nghiệp vụ nhưng không nên được lộ ra bên ngoài thông qua API.

-- What are DTOs? -- 
- DTO là các lớp dùng để truyền dữ liệu giữa các tầng của ứng dụng, đặc biệt là giữa server và client. 
- DTO là phiên bản đơn giản hóa của model, chỉ chứa những trường thông tin cần thiết để trả về cho client. Việc sử dụng DTO mang lại nhiều lợi ích:
  1. Bảo mật: 
    - DTO giúp giới hạn dữ liệu trả về, đảm bảo không để lộ những thông tin nhạy cảm như mật khẩu, lương, chi phí nội bộ, v.v.
  2. Hiệu năng:
    -  Chỉ truyền những dữ liệu cần thiết sẽ giảm kích thước payload, giúp tăng tốc độ xử lý và truyền tải.
  3. Tách biệt các mối quan tâm (Separation of Concerns): 
    - Việc sử dụng DTO giúp tách biệt cấu trúc nội bộ của database khỏi hợp đồng API, làm cho hệ thống linh hoạt và dễ bảo trì hơn.
- Tùy biến dữ liệu đầu ra (Data Shaping): DTO cho phép điều chỉnh hoặc đổi tên các trường dữ liệu (ví dụ: từ Name thành ProductName) để phù hợp với yêu cầu của client mà không ảnh hưởng đến model gốc trong domain.

-- Drawbacks of Not Using AutoMapper: --
- Nếu không sử dụng AutoMapper, chúng ta phải tự ánh xạ (mapping) thủ công từng trường (field) từ entity sang DTO và ngược lại. 
- Ví dụ, trong phương thức GET của controller, khi lấy danh sách sản phẩm, ta cần duyệt thủ công qua từng đối tượng và tạo danh sách các đối tượng ProductDTO. 
- Tương tự, khi tạo mới hoặc cập nhật sản phẩm, ta cũng phải ánh xạ thủ công các thuộc tính từ DTO về entity trước khi lưu vào cơ sở dữ liệu. Mặc dù việc ánh xạ thủ công vẫn hoạt động, nhưng nó tồn tại một số hạn chế sau:
  1. Lặp lại mã nguồn (Repetitive Code): 
    - Mỗi lần ánh xạ giữa Product và ProductDTO, ta phải viết lại toàn bộ đoạn mã ánh xạ thủ công, dẫn đến mã nguồn bị lặp lại, dễ gây lỗi và làm giảm tính dễ đọc.
  2. Khó bảo trì (Maintenance Overhead): 
    - Khi mô hình dữ liệu thay đổi (ví dụ thêm một thuộc tính mới), ta cần sửa lại tất cả các vị trí có logic ánh xạ trong toàn bộ mã nguồn. Việc bỏ sót cập nhật ở một nơi nào đó có thể gây ra lỗi và hành vi không mong muốn.
  3. Dễ gây lỗi (Error-Prone): 
    - Ánh xạ thủ công làm tăng nguy cơ xảy ra lỗi, chẳng hạn như quên ánh xạ một trường dữ liệu hoặc ánh xạ sai kiểu giá trị, dẫn đến dữ liệu không đồng nhất và lỗi khó phát hiện trong runtime.
  4. Vi phạm nguyên tắc DRY (Don’t Repeat Yourself): 
    - Khi logic ánh xạ được lặp lại ở nhiều nơi như trong cả GetProducts và GetProductById, mã nguồn trở nên rườm rà và khó bảo trì. Nguyên tắc DRY bị phá vỡ do logic ánh xạ bị trùng lặp ở nhiều controller.

-- What is Automapper in ASP.NET Core Web API? -- 
- AutoMapper là một thư viện ánh xạ đối tượng sang đối tượng (object-to-object mapping) giúp tự động hóa quá trình ánh xạ dữ liệu giữa các lớp khác nhau. 
- Nó cho phép chúng ta định nghĩa cấu hình ánh xạ (mapping configuration) tại một nơi duy nhất (thông qua Mapping Profile) và sử dụng lại ở nhiều nơi trong ứng dụng. 
- Điều này giúp mã nguồn trở nên sạch hơn, dễ bảo trì hơn và giảm thiểu rủi ro do lỗi thủ công.
- Cụ thể, AutoMapper mang lại các lợi ích sau:
  - Loại bỏ phần lớn việc ánh xạ thủ công giữa các thuộc tính.
  - Tự động ánh xạ dựa trên quy ước, chẳng hạn như tên và kiểu dữ liệu thuộc tính giống nhau.
  - Cho phép tùy chỉnh ánh xạ theo nhu cầu thông qua các cấu hình trong profile.
- Trong ngữ cảnh của ứng dụng ASP.NET Core Web API, AutoMapper giúp đơn giản hóa quá trình ánh xạ dữ liệu giữa Model (hoặc Entity) và DTO (Data Transfer Object), từ đó giảm đáng kể số dòng mã cần viết khi truyền dữ liệu giữa các tầng của ứng dụng.

-- Handling Mismatched Property Names --
- Khi tên và kiểu dữ liệu của các thuộc tính giữa đối tượng nguồn (source) và đối tượng đích (destination) giống nhau, AutoMapper sẽ tự động ánh xạ các thuộc tính này. 
- Tuy nhiên, khi tên thuộc tính khác nhau (ví dụ: Name so với ProductName, Description so với ShortDescription), AutoMapper sẽ không tự động ánh xạ được. 
- Vì vậy, chúng ta cần sử dụng phương thức ForMember trong Mapping Profile. 
- Phương thức ForMember cho phép chúng ta chỉ định rõ cách ánh xạ giữa các thuộc tính không trùng tên. Khi cấu hình này được thiết lập, dữ liệu đầu ra sau khi ánh xạ sẽ có giá trị đúng như mong muốn.

-- Benefits with AutoMapper --
- Dưới đây là một số lợi ích chính khi sử dụng AutoMapper:
  1. Loại bỏ mã ánh xạ lặp đi lặp lại: Tất cả logic ánh xạ được tập trung và quản lý tại một nơi duy nhất (Profile).
  2. Dễ bảo trì: Khi có thay đổi ở mô hình dữ liệu, bạn chỉ cần cập nhật lại trong Profile thay vì sửa ở nhiều nơi trong mã nguồn.
  3. Tính nhất quán cao: Cấu hình ánh xạ được áp dụng xuyên suốt toàn bộ ứng dụng, giúp giảm thiểu sai sót.
  4. Giảm lỗi khi ánh xạ: AutoMapper hỗ trợ ánh xạ thuộc tính một cách nhất quán, kể cả khi tên thuộc tính khác nhau (với cấu hình rõ ràng).
- AutoMapper giúp đơn giản hóa quá trình ánh xạ giữa các đối tượng, loại bỏ sự dư thừa và giảm thiểu lỗi logic. 
- Khi kết hợp với mô hình DTO hợp lý, chúng ta có thể bảo vệ các trường nhạy cảm, cải thiện hiệu năng, và duy trì sự phân tách rõ ràng giữa các tầng trong ứng dụng.

