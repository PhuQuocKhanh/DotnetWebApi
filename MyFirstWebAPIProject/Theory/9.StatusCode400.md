-- MÃ£ tráº¡ng thÃ¡i HTTP 400: Bad Request (YÃªu cáº§u khÃ´ng há»£p lá»‡) --
- MÃ£ tráº¡ng thÃ¡i HTTP 400, hay cÃ²n gá»i lÃ  â€œBad Requestâ€, cho biáº¿t ráº±ng yÃªu cáº§u (request) Ä‘Æ°á»£c gá»­i tá»« client Ä‘áº¿n server khÃ´ng há»£p lá»‡ hoáº·c bá»‹ lá»—i, khiáº¿n server khÃ´ng thá»ƒ xá»­ lÃ½ Ä‘Æ°á»£c yÃªu cáº§u Ä‘Ã³. Lá»—i nÃ y cÃ³ thá»ƒ xáº£y ra vÃ¬ nhiá»u lÃ½ do, bao gá»“m:
- URL khÃ´ng há»£p lá»‡: URL cÃ³ thá»ƒ bá»‹ sai cÃº phÃ¡p, chá»©a kÃ½ tá»± khÃ´ng há»£p lá»‡ hoáº·c khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng.
- Tham sá»‘ truy váº¥n (query parameters) khÃ´ng há»£p lá»‡: CÃ¡c tham sá»‘ trong query string cÃ³ thá»ƒ bá»‹ thiáº¿u, sai Ä‘á»‹nh dáº¡ng hoáº·c khÃ´ng Ä‘Æ°á»£c mÃ£ hÃ³a Ä‘Ãºng cÃ¡ch.
- Header khÃ´ng há»£p lá»‡: CÃ¡c header trong request cÃ³ thá»ƒ bá»‹ thiáº¿u, sai Ä‘á»‹nh dáº¡ng hoáº·c khÃ´ng há»£p lá»‡.
- Payload quÃ¡ lá»›n: Pháº§n thÃ¢n cá»§a request (payload) cÃ³ thá»ƒ vÆ°á»£t quÃ¡ giá»›i háº¡n kÃ­ch thÆ°á»›c mÃ  server cho phÃ©p.
- Cookie lá»—i: CÃ³ thá»ƒ cÃ³ váº¥n Ä‘á» vá»›i cookie Ä‘Æ°á»£c gá»­i kÃ¨m trong request nhÆ° bá»‹ há»ng hoáº·c khÃ´ng há»£p lá»‡.
- Payload khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng: Ná»™i dung gá»­i trong body cá»§a request khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng mÃ  server yÃªu cáº§u (vÃ­ dá»¥: JSON khÃ´ng há»£p lá»‡).
- Content-Type khÃ´ng Ä‘Ãºng: Header Content-Type khÃ´ng phÃ¹ há»£p vá»›i Ä‘á»‹nh dáº¡ng cá»§a payload, hoáº·c lÃ  loáº¡i khÃ´ng Ä‘Æ°á»£c server há»— trá»£.

- CÃ¡ch xá»­ lÃ½ lá»—i 400 Bad Request:
- Khi phÃ¡t triá»ƒn cÃ¡c á»©ng dá»¥ng web hoáº·c API, báº¡n cáº§n xá»­ lÃ½ vÃ  kháº¯c phá»¥c lá»—i 400 má»™t cÃ¡ch chÃ­nh xÃ¡c. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ bÆ°á»›c Ä‘á»ƒ kiá»ƒm tra vÃ  sá»­a lá»—i:
  1. Kiá»ƒm tra URL: Äáº£m báº£o URL Ä‘Æ°á»£c viáº¿t Ä‘Ãºng cÃº phÃ¡p, khÃ´ng chá»©a kÃ½ tá»± Ä‘áº·c biá»‡t khÃ´ng há»£p lá»‡.
  2. XÃ¡c thá»±c query string: Kiá»ƒm tra vÃ  Ä‘áº£m báº£o cÃ¡c tham sá»‘ trÃªn URL Ä‘Æ°á»£c mÃ£ hÃ³a Ä‘Ãºng vÃ  cÃ³ giÃ¡ trá»‹ há»£p lá»‡.
  3. RÃ  soÃ¡t header: Äáº£m báº£o táº¥t cáº£ cÃ¡c header cáº§n thiáº¿t Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p Ä‘Ãºng vÃ  há»£p lá»‡. 
  4. Kiá»ƒm tra payload: XÃ¡c nháº­n ráº±ng payload khÃ´ng quÃ¡ lá»›n, Ä‘Ãºng Ä‘á»‹nh dáº¡ng (vÃ­ dá»¥ JSON, XML,...) vÃ  Ä‘áº§y Ä‘á»§ dá»¯ liá»‡u báº¯t buá»™c.
  5. XÃ³a cookie: Náº¿u nghi ngá» cookie gÃ¢y lá»—i, thá»­ xÃ³a cookie khá»i trÃ¬nh duyá»‡t hoáº·c client.
  6. Kiá»ƒm tra Content-Type: Äáº£m báº£o Content-Type pháº£n Ã¡nh Ä‘Ãºng Ä‘á»‹nh dáº¡ng cá»§a dá»¯ liá»‡u trong request body, vÃ­ dá»¥ application/json náº¿u gá»­i JSON.

- LÆ°u Ã½: Khi server tráº£ vá» mÃ£ lá»—i 400, trong pháº§n response body thÆ°á»ng sáº½ chá»©a thÃ´ng tin chi tiáº¿t hÆ¡n vá» lÃ½ do lá»—i, giÃºp client hiá»ƒu vÃ  Ä‘iá»u chá»‰nh láº¡i request cho Ä‘Ãºng. MÃ£ lá»—i 400 mang Ã½ nghÄ©a lÃ  lá»—i thuá»™c vá» phÃ­a client, khÃ´ng pháº£i lá»—i há»‡ thá»‘ng server.

-- Giáº£i thÃ­ch chi tiáº¿t ná»™i dung pháº£n há»“i lá»—i 400: -- 
- type: Má»™t Ä‘Æ°á»ng dáº«n URI trá» Ä‘áº¿n tÃ i liá»‡u mÃ´ táº£ lá»—i cá»¥ thá»ƒ. Trong vÃ­ dá»¥ nÃ y, URI trá» Ä‘áº¿n Section 15.5.1 cá»§a RFC 9110, giáº£i thÃ­ch cÃ¡ch sá»­ dá»¥ng mÃ£ tráº¡ng thÃ¡i HTTP vÃ  cáº¥u trÃºc thÃ´ng bÃ¡o lá»—i chuáº©n trong API. (Báº¡n cÃ³ thá»ƒ copy Ä‘Æ°á»ng link nÃ y vÃ  má»Ÿ trong trÃ¬nh duyá»‡t Ä‘á»ƒ Ä‘á»c thÃªm).
- title: MÃ´ táº£ ngáº¯n gá»n, dá»… hiá»ƒu vá» báº£n cháº¥t lá»—i. á» Ä‘Ã¢y lÃ :
  ğŸ‘‰ â€œOne or more validation errors occurred.â€
  â†’ CÃ³ nghÄ©a lÃ  cÃ³ má»™t hoáº·c nhiá»u lá»—i xÃ¡c thá»±c trong dá»¯ liá»‡u Ä‘áº§u vÃ o.
- status: MÃ£ tráº¡ng thÃ¡i HTTP tÆ°Æ¡ng á»©ng, á»Ÿ Ä‘Ã¢y lÃ  400, tÆ°Æ¡ng á»©ng vá»›i lá»—i Bad Request â€” tá»©c lÃ  server khÃ´ng thá»ƒ xá»­ lÃ½ Ä‘Æ°á»£c yÃªu cáº§u do dá»¯ liá»‡u tá»« phÃ­a client khÃ´ng há»£p lá»‡.
- errors: ÄÃ¢y lÃ  Ä‘á»‘i tÆ°á»£ng chá»©a thÃ´ng tin cÃ¡c trÆ°á»ng dá»¯ liá»‡u khÃ´ng há»£p lá»‡ cÃ¹ng vá»›i thÃ´ng Ä‘iá»‡p lá»—i cá»¥ thá»ƒ cho tá»«ng trÆ°á»ng. VÃ­ dá»¥:

    City: "The City field is required." â†’ TrÆ°á»ng City lÃ  báº¯t buá»™c nhÆ°ng khÃ´ng Ä‘Æ°á»£c cung cáº¥p.

    Name: "The Name field is required."

    Gender: "The Gender field is required."

- traceId: MÃ£ Ä‘á»‹nh danh duy nháº¥t cho request nÃ y.
â†’ traceId ráº¥t há»¯u Ã­ch cho viá»‡c theo dÃµi (trace) vÃ  debug. NÃ³ giÃºp láº­p trÃ¬nh viÃªn liÃªn káº¿t lá»—i nÃ y vá»›i log ná»™i bá»™ trÃªn server. ASP.NET Core sáº½ tá»± Ä‘á»™ng sinh traceId náº¿u há»‡ thá»‘ng logging vÃ  diagnostics Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘Ãºng cÃ¡ch.

-- CÃ¡ch pháº£n há»“i lá»—i Ä‘Æ°á»£c sinh ra --
- Pháº£n há»“i lá»—i nÃ y Ä‘Æ°á»£c ASP.NET Core tá»± Ä‘á»™ng sinh ra khi quÃ¡ trÃ¬nh xÃ¡c thá»±c model (model validation) khÃ´ng thÃ nh cÃ´ng.
- Khi má»™t phÆ°Æ¡ng thá»©c trong controller Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u vá»›i thuá»™c tÃ­nh [ApiController], framework sáº½ tá»± Ä‘á»™ng thá»±c hiá»‡n kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a dá»¯ liá»‡u Ä‘áº§u vÃ o (model) trÆ°á»›c khi phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c thá»±c thi.
- Náº¿u viá»‡c kiá»ƒm tra khÃ´ng thÃ nh cÃ´ng, framework sáº½ tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng ValidationProblemDetails vá»›i cáº¥u trÃºc chuáº©n cÃ³ sáºµn nhÆ° Ä‘Ã£ mÃ´ táº£. 
- ToÃ n bá»™ quÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n tá»± Ä‘á»™ng bá»Ÿi framework, trÆ°á»›c khi phÆ°Æ¡ng thá»©c controller Ä‘Æ°á»£c cháº¡y, vÃ¬ váº­y khÃ´ng cáº§n thiáº¿t pháº£i kiá»ƒm tra ModelState.IsValid trong phÆ°Æ¡ng thá»©c ná»¯a.

-- ProblemDetails for API Errors in ASP.NET Core --
- Lá»›p ProblemDetails Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Ä‘Ã³ng gÃ³i thÃ´ng tin lá»—i theo Ä‘á»‹nh dáº¡ng cÃ³ cáº¥u trÃºc, giÃºp client (bÃªn tiÃªu thá»¥ API) dá»… dÃ ng hiá»ƒu Ä‘Æ°á»£c lá»—i xáº£y ra lÃ  gÃ¬. Khi báº¡n xem Ä‘á»‹nh nghÄ©a cá»§a lá»›p ProblemDetails, báº¡n sáº½ tháº¥y chá»¯ kÃ½ nhÆ° sau:

-- Ã nghÄ©a cÃ¡c thuá»™c tÃ­nh trong ProblemDetails -- 
1. Type
  - MÃ´ táº£: URI Ä‘áº¡i diá»‡n cho loáº¡i lá»—i (problem type).
  - Ã nghÄ©a: Tham chiáº¿u Ä‘áº¿n má»™t trang tÃ i liá»‡u mÃ´ táº£ chi tiáº¿t vá» loáº¡i lá»—i cá»¥ thá»ƒ, giÃºp client hiá»ƒu rÃµ hÆ¡n vá» lá»—i. ÄÃ¢y lÃ  trÆ°á»ng tÃ¹y chá»n.
  - VÃ­ dá»¥: https://tools.ietf.org/html/rfc7231#section-6.5.1 (mÃ´ táº£ lá»—i HTTP 400 Bad Request).
2. Title
  - MÃ´ táº£: TiÃªu Ä‘á» ngáº¯n gá»n, dá»… Ä‘á»c mÃ´ táº£ vá» loáº¡i lá»—i.
  - Ã nghÄ©a: Cung cáº¥p mÃ´ táº£ ngáº¯n, dáº¡ng vÄƒn báº£n thuáº§n (plain text), dá»… hiá»ƒu Ä‘á»‘i vá»›i ngÆ°á»i dÃ¹ng cuá»‘i. DÃ¹ng Ä‘á»ƒ nhanh chÃ³ng truyá»n táº£i lá»—i lÃ  gÃ¬.
  - VÃ­ dá»¥: "Invalid Request Parameters", "Authentication Failed".
3. Status: 
  - MÃ´ táº£: MÃ£ tráº¡ng thÃ¡i HTTP á»©ng vá»›i lá»—i.
  - Ã nghÄ©a: ÄÃ¢y lÃ  mÃ£ tráº¡ng thÃ¡i HTTP mÃ  server tráº£ vá» tÆ°Æ¡ng á»©ng vá»›i lá»—i xáº£y ra. GiÃºp client xÃ¡c Ä‘á»‹nh rÃµ lá»—i theo chuáº©n HTTP.
    - VÃ­ dá»¥:
    - 400 â€“ Bad Request
    - 404 â€“ Not Found
    - 500 â€“ Internal Server Error
4. Detail
- MÃ´ táº£: MÃ´ táº£ chi tiáº¿t lá»—i cá»¥ thá»ƒ trong láº§n xáº£y ra nÃ y.
- Ã nghÄ©a: Cung cáº¥p thÃ´ng tin chi tiáº¿t hÆ¡n so vá»›i Title, giÃºp láº­p trÃ¬nh viÃªn dá»… debug hoáº·c cung cáº¥p thÃ´ng bÃ¡o cá»¥ thá»ƒ hÆ¡n cho ngÆ°á»i dÃ¹ng.
- VÃ­ dá»¥: "The field 'username' is required but was not provided."
5. Instance
- MÃ´ táº£: URI tham chiáº¿u Ä‘áº¿n phiÃªn báº£n lá»—i cá»¥ thá»ƒ.
- Ã nghÄ©a: DÃ¹ng Ä‘á»ƒ theo dÃµi hoáº·c Ä‘á»‹nh danh tá»«ng trÆ°á»ng há»£p lá»—i cá»¥ thá»ƒ. Ráº¥t há»¯u Ã­ch cho viá»‡c log lá»—i hoáº·c há»— trá»£ ká»¹ thuáº­t.
- VÃ­ dá»¥: https://example.com/logs/12345 (URI tá»›i chi tiáº¿t log lá»—i).
6. Extensions
- MÃ´ táº£: Thuá»™c tÃ­nh má»Ÿ rá»™ng dÆ°á»›i dáº¡ng dictionary (tá»« Ä‘iá»ƒn).
- Ã nghÄ©a: Cho phÃ©p thÃªm cÃ¡c thÃ´ng tin tÃ¹y biáº¿n bÃªn ngoÃ i cÃ¡c trÆ°á»ng máº·c Ä‘á»‹nh. Ráº¥t phÃ¹ há»£p Ä‘á»ƒ truyá»n cÃ¡c metadata hoáº·c hÆ°á»›ng dáº«n bá»• sung.
- VÃ­ dá»¥:
  - { "retryAfter": 30 } (client nÃªn Ä‘á»£i 30 giÃ¢y trÆ°á»›c khi gá»­i láº¡i request).

-- When to Use 400 HTTP Status Code in ASP.NET Core Web API --
1. Lá»—i xÃ¡c thá»±c (Validation Failures)
- Khi dá»¯ liá»‡u do client gá»­i lÃªn khÃ´ng vÆ°á»£t qua Ä‘Æ°á»£c cÃ¡c bÆ°á»›c xÃ¡c thá»±c â€” cháº³ng háº¡n nhÆ° thiáº¿u cÃ¡c trÆ°á»ng báº¯t buá»™c, sai kiá»ƒu dá»¯ liá»‡u, hoáº·c khÃ´ng thá»a mÃ£n cÃ¡c rÃ ng buá»™c Ä‘Ã£ Ä‘á»‹nh nghÄ©a â€” thÃ¬ API nÃªn tráº£ vá» mÃ£ lá»—i 400. Äiá»u nÃ y giÃºp client hiá»ƒu ráº±ng há» cáº§n hiá»‡u chá»‰nh dá»¯ liá»‡u Ä‘áº§u vÃ o Ä‘á»ƒ Ä‘Ãºng vá»›i Ä‘á»‹nh dáº¡ng mÃ  API yÃªu cáº§u.
2. Thiáº¿u hoáº·c sai Ä‘á»‹nh dáº¡ng tham sá»‘ (Missing or Malformed Parameters)
- Khi request khÃ´ng chá»©a Ä‘á»§ cÃ¡c tham sá»‘ báº¯t buá»™c (vÃ­ dá»¥: query string, route parameter) hoáº·c Ä‘á»‹nh dáº¡ng sai (cháº³ng háº¡n gá»­i chuá»—i trong khi há»‡ thá»‘ng yÃªu cáº§u sá»‘), thÃ¬ nÃªn tráº£ vá» mÃ£ lá»—i 400. Äiá»u nÃ y cÅ©ng Ã¡p dá»¥ng cho cÃ¡c pháº§n khÃ¡c cá»§a request nhÆ° header náº¿u chÃºng khÃ´ng Ä‘Ãºng chuáº©n Ä‘á»‹nh dáº¡ng mong muá»‘n.
3. Payload khÃ´ng há»£p lá»‡ (Invalid Request Payload)
- Khi pháº§n thÃ¢n (body) cá»§a request bá»‹ sai cÃº phÃ¡p â€” vÃ­ dá»¥: JSON hoáº·c XML bá»‹ lá»—i cáº¥u trÃºc â€” thÃ¬ server khÃ´ng thá»ƒ phÃ¢n tÃ­ch Ä‘Æ°á»£c ná»™i dung, vÃ  lÃºc nÃ y mÃ£ lá»—i 400 lÃ  lá»±a chá»n phÃ¹ há»£p. ThÃ´ng bÃ¡o nÃ y cho biáº¿t phÃ­a client cáº§n sá»­a láº¡i payload trÆ°á»›c khi gá»­i láº¡i.
4. Vi pháº¡m logic nghiá»‡p vá»¥ (Business Logic Violations)
- Ngay cáº£ khi dá»¯ liá»‡u há»£p lá»‡ vá» máº·t ká»¹ thuáº­t vÃ  Ä‘á»‹nh dáº¡ng, nhÆ°ng náº¿u vi pháº¡m quy táº¯c nghiá»‡p vá»¥ (cháº³ng háº¡n nhÆ° táº¡o báº£n ghi trÃ¹ng láº·p trong khi há»‡ thá»‘ng yÃªu cáº§u duy nháº¥t), thÃ¬ API váº«n cÃ³ thá»ƒ tráº£ vá» mÃ£ 400. Äiá»u nÃ y giÃºp client biáº¿t ráº±ng thao tÃ¡c khÃ´ng thá»ƒ thá»±c hiá»‡n do vi pháº¡m cÃ¡c quy táº¯c xá»­ lÃ½ nghiá»‡p vá»¥ Ä‘Æ°á»£c há»‡ thá»‘ng Ä‘á»‹nh nghÄ©a.
