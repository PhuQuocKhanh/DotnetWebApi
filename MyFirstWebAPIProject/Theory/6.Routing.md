-- Why Routing in ASP.NET Core Web API? --
- Khi client gửi một request tới server, như đã đề cập, request đó phải đi qua Request Processing Pipeline. 
- Nếu mọi thứ hợp lệ, framework ASP.NET Core sẽ định tuyến request đó tới đúng action method trong controller.
- Action method này sẽ xử lý request và tạo response tương ứng.
- Routing trong ASP.NET Core Web API là cơ chế ánh xạ các HTTP request đến các action method tương ứng trong controller dựa trên URL và HTTP method.
- Nó đóng vai trò như một bộ định tuyến, giúp hệ thống xác định chính xác endpoint nào sẽ xử lý request đến.

-- What Is Routing in ASP.NET Core? --
- Định tuyến trong ASP.NET Core là một cơ chế dùng để ánh xạ các yêu cầu HTTP đến các phương thức hành động (action methods) cụ thể trong controller của ứng dụng. 
- Khi một yêu cầu HTTP đến, Routing Engine sẽ kiểm tra URL (và có thể cả dữ liệu khác như phương thức HTTP, Route Data, v.v.) để xác định phương thức hành động nào trong controller nào sẽ xử lý yêu cầu đó.
1. Yêu cầu HTTP đến (Incoming HTTP Request):
  - Một client (ví dụ: trình duyệt, Postman, Swagger, Fiddler hoặc ứng dụng di động) gửi yêu cầu HTTP đến máy chủ. Yêu cầu này thường bao gồm:
    - Phương thức HTTP: Xác định loại thao tác (GET, POST, PUT, PATCH, DELETE).
    - URL: Địa chỉ chỉ định tài nguyên được truy cập (ví dụ: https://example.com/api/customers/5).
    - Headers: Siêu dữ liệu về yêu cầu (ví dụ: Authorization, Content-Type, Accept).
    - Query String (tùy chọn): Tham số bổ sung trong URL (ví dụ: ?search=abc).
    - Request Body (tùy chọn): Dữ liệu gửi kèm với các yêu cầu POST, PUT, PATCH (ví dụ: payload JSON để tạo/cập nhật tài nguyên).
2. Phân Tích URL (URL Parsing):
  - Khi máy chủ nhận yêu cầu, Middleware Định Tuyến sẽ phân tích URL thành các thành phần để xác định tài nguyên mà client yêu cầu. Ví dụ, URL https://example.com/api/customers/5 được chia thành:
    - Scheme: https (giao thức sử dụng).
    - Host: example.com (máy chủ hoặc domain).
    - Path: /api/customers/5 (đường dẫn xác định tài nguyên hoặc endpoint).
    - Query String: Tham số bổ sung nếu có (ví dụ: ?search=abc).
    - Tìm Route Khớp (Find Matching Route):
  - Routing Engine kiểm tra URL đã phân tích và so khớp với Route Table (bảng định tuyến) của ứng dụng. Route Table là tập hợp các mẫu route được định nghĩa thông qua Attribute Routing hoặc Conventional Routing. Mỗi mẫu route xác định:
3. Tên controller
  - Tên phương thức hành động (action method)
  - Phương thức HTTP hỗ trợ
  - Tham số route
  - Giá trị mặc định và ràng buộc
  - Routing Engine so sánh các phân đoạn URL (ví dụ: /api/customers/5) với các mẫu route trong Route Table để quyết định controller và action nào sẽ xử lý yêu cầu.
-- Route Found? -- 
- Ở giai đoạn này, bộ định tuyến kiểm tra xem có route phù hợp nào trong bảng route không.
1. Không tìm thấy kết quả (Lỗi HTTP 404)
  - Nếu không tìm thấy route phù hợp, ứng dụng trả về lỗi HTTP 404 Not Found, cho biết không thể tìm thấy tài nguyên hoặc trang được yêu cầu.
2. Tìm thấy kết quả (Xử lý yêu cầu)
- Nếu tìm thấy route phù hợp:
  - Controller Factory tạo một thể hiện của controller được chọn
  - Framework gọi phương thức action phù hợp để xử lý yêu cầu và tạo phản hồi

3. Quá trình xử lý yêu cầu
- Khi yêu cầu khớp với một route, các bước sau xảy ra:
  - Model Binding: Trích xuất dữ liệu từ route, query string, headers hoặc body và liên kết với các tham số action hoặc model
  - Action Filters: Thực thi các bộ lọc được định nghĩa cho action (ví dụ: xác thực, ghi log)
  - Action Execution: Chạy logic trong phương thức action để xử lý yêu cầu
  - Response Generation: Chuẩn bị phản hồi (ví dụ: JSON, HTML) để gửi đến client

4. Gửi phản hồi
- Kết quả của phương thức action (ví dụ: View, JSON, XML) được gửi lại cho client dưới dạng HTTP response, bao gồm:
  - Status Code: Chỉ định kết quả (ví dụ: 200 OK, 404 Not Found, 500 Internal Server Error)
  - Content: Dữ liệu phản hồi thực tế (ví dụ: HTML, JSON hoặc plain text)
  - Headers: Metadata về phản hồi (ví dụ: Content-Type, Cache-Control)
5. Các loại định tuyến được hỗ trợ bởi ASP.NET Core
- ASP.NET Core hỗ trợ 2 chiến lược định tuyến chính:
  - Convention-Based Routing: Được cấu hình toàn cục, thường trong file Program.cs
  - Attribute-Based Routing: Được cấu hình bằng các thuộc tính áp dụng trực tiếp trên controller và phương thức action

6. Convention-Based Routing trong ASP.NET Core
  - Convention-based routing định nghĩa các mẫu URL và ánh xạ chúng tới các action của controller dựa trên các quy ước định trước.
  - Cách tiếp cận này tập trung cấu hình route, giúp dễ quản lý, đặc biệt trong các ứng dụng có nhiều controller và action.
  - Trong file Program.cs, convention-based routing thường được cấu hình bằng phương thức MapControllerRoute. Cú pháp như sau:

    app.MapControllerRoute(
        name: "default",
        pattern: "{controller=Home}/{action=Index}/{id?}");
- Điều này định nghĩa một mẫu mặc định cho các route, trong đó:
  1. {controller} là tên controller
  2. {action} là phương thức action
  3. {id?} là tham số route tùy chọn

-- What is a Route Table in ASP.NET Core? --
- Khi ứng dụng khởi động, ASP.NET Core quét các controller và các thuộc tính định tuyến (route attributes) để xây dựng một Bảng Định Tuyến. 
- Bảng này chứa các mục nhập (entries) tương ứng với từng mẫu URL. 
- Mỗi Mục Nhập Định Tuyến (Route Entry) trong Bảng Định Tuyến thường bao gồm các thành phần sau:
  - Route Template: Định nghĩa cấu trúc URL (ví dụ: Emp/All), quy định cách URL phải khớp với route này.
  - Defaults: Giá trị ngầm định cho các tham số nếu chúng không được cung cấp trong URL. 
    Ví dụ: Trong api/{controller=Home}/{action=Index}/{id?}, Home và Index là giá trị mặc định cho controller và action.
  - Constraints: Điều kiện mà các tham số phải thỏa mãn để route được coi là khớp. 
    Ví dụ: {id:int} đảm bảo id phải là số nguyên.
  - Handlers: Một delegate trỏ đến action của controller sẽ xử lý yêu cầu.
    Khi delegate được gọi, phương thức action tương ứng sẽ thực thi. Mỗi endpoint có một bộ xử lý riêng.

-- Conventional-Based Routing --
- Nếu bạn muốn sử dụng Conventional-Based Routing, hãy thêm middleware MapControllerRoute vào file Program.cs.
- Ở đây, chúng ta cấu hình Route Pattern là api/{controller}/{action}/{id?} với id là tham số tùy chọn:
    app.MapControllerRoute(
        name: "default",
        pattern: "api/{controller}/{action}/{id?}");

-- Differences Between Route Attribute and HTTP Method Attribute: --
- Trong ASP.NET Core Web API, cả Route Attribute ([Route]) và HTTP Method Attribute đều được sử dụng để áp dụng các mẫu route cho các action của controller, nhưng chúng có mục đích hơi khác nhau:
  1. Route Attribute ([Route]):
    - Được sử dụng để chỉ định một mẫu route (route template) cho một controller hoặc một action.
    - Có thể áp dụng ở cấp controller để định nghĩa một route cơ sở cho tất cả các action trong controller đó.
    - Cũng có thể áp dụng ở cấp action để định nghĩa các route cụ thể cho từng action riêng lẻ.
  2. HTTP Method Attribute ([HttpGet], [HttpPost], [HttpPut], [HttpDelete], [HttpPatch]):
    - Xác định rõ ràng các phương thức HTTP mà một action method có thể phản hồi.
    - Các thuộc tính này làm rõ loại HTTP request (GET, POST, PUT, DELETE, PATCH) mà một action có thể xử lý.
    - HTTP Method Attributes cũng có thể định nghĩa mẫu route, nghĩa là chúng phục vụ hai mục đích: Loại phương thức (Method Type) và Mẫu URL (URL Pattern).

-- When to Use Convention-Based vs Attribute-Based Routing? --
- Nếu ứng dụng của bạn hoàn toàn là Web API, thông thường nên sử dụng attribute routing để đảm bảo rõ ràng và minh bạch.
- Convention-based routing phổ biến hơn trong các ứng dụng MVC sử dụng Razor views.
- ASP.NET Core cho phép kết hợp cả hai cách tiếp cận nếu cần thiết.

-- Route Data and Query Strings in ASP.NET Core Web API Routing --
- Khi phát triển các dịch vụ RESTful thời gian thực với ASP.NET Core Web API, việc xử lý dữ liệu động như lấy chi tiết đơn hàng theo ID, truy xuất thông tin nhân viên, tìm sách theo tác giả và lấy sản phẩm theo ID là rất quan trọng. Trong ASP.NET Core Web API, Dữ liệu Route (Route Data) và Query Strings là hai cơ chế chính để truyền dữ liệu động từ client tới server.

-- Route Data in ASP.NET Core Web API Routing --
- Dữ liệu Route được sử dụng để truyền thông tin như một phần của đường dẫn URL.
- Nó thường được dùng để xác định các tài nguyên cụ thể hoặc một nhóm tài nguyên, chẳng hạn như ID hoặc tên, những thông tin cần thiết để định vị dữ liệu cụ thể. 
- Các tham số route được nhúng trong chính đường dẫn URL và thường là bắt buộc để hoàn thành yêu cầu.
- Sử dụng tham số route cho các thông tin bắt buộc để nhận dạng hoặc định vị tài nguyên (ví dụ: ID nhân viên hoặc số đơn hàng). 
- Các tham số route thường là bắt buộc để endpoint hoạt động chính xác. Nếu thiếu tham số route, đường dẫn sẽ không khớp và phương thức action sẽ không được thực thi. Do đó, thiếu tham số route sẽ dẫn đến lỗi 404 Not Found.

-- What Is a Query String? --
- Chuỗi truy vấn là các cặp khóa-giá trị được thêm vào URL sau dấu hỏi (?).
- Nhiều tham số truy vấn được phân tách bằng dấu &. 
- Chúng thường cung cấp các tiêu chí tùy chọn hoặc thông tin bổ sung để lọc, tìm kiếm hoặc phân trang. 
- Trong một API RESTful thông thường, chúng không được dùng để xác định tài nguyên chính.
- Sử dụng chuỗi truy vấn cho các tham số không cần thiết để định danh tài nguyên nhưng làm thay đổi phản hồi (ví dụ: bộ lọc, sắp xếp). 
- Khi cần truyền nhiều tham số tùy chọn, chuỗi truy vấn cung cấp cách thức linh hoạt và rõ ràng để bao gồm chúng. Bạn có thể chỉ định bao nhiêu tham số tùy chọn tùy ý và theo bất kỳ thứ tự nào.

-- Accessing Query Strings Directly from HttpContext --
- Trong các tình huống yêu cầu kiểm soát hoặc linh hoạt cao hơn, bạn có thể truy cập trực tiếp các tham số query string từ HttpContext. Để hiểu rõ hơn, vui lòng sửa đổi EmployeeController như sau.
- Ở đây, chúng ta truy cập các giá trị tham số query string Gender, City và Department trực tiếp từ phương thức action bằng cách sử dụng collection HttpContext.Request.Query.

-- Query String vs Route Parameter in ASP.NET Core Web API --
- Hiểu rõ sự khác biệt giữa chuỗi truy vấn và tham số đường dẫn trong ASP.NET Core Web API là yếu tố cần thiết để thiết kế API hiệu quả. 
- Cả hai đều được sử dụng để truyền thông tin đến máy chủ, nhưng chúng phục vụ các mục đích khác nhau và có những ảnh hưởng khác biệt đến khả năng sử dụng và chức năng của API. Dưới đây là những khác biệt chính:
- Khác biệt chính
  1. Vị trí trong URL:
    - Tham số đường dẫn là một phần của đường dẫn URL
    - Chuỗi truy vấn được thêm vào cuối URL
  2. Tính bắt buộc:
    - Tham số đường dẫn thường là bắt buộc
    - Chuỗi truy vấn là tùy chọn
  3. Trường hợp sử dụng:
    - Tham số đường dẫn dùng để xác định tài nguyên cụ thể (ví dụ: một sản phẩm nhất định)
    - Chuỗi truy vấn dùng cho các thông tin bổ sung của yêu cầu (ví dụ: bộ lọc, từ khóa tìm kiếm)

-- What are Tokens in ASP.NET Core Attribute Routing? --
- Trong ASP.NET Core, định tuyến thuộc tính (attribute routing) là một tính năng cho phép chúng ta định nghĩa các route trực tiếp trên controller và action bằng cách sử dụng các thuộc tính như [Route] hoặc các thuộc tính HTTP method.
- Tokens trong định tuyến thuộc tính là các trình giữ chỗ (placeholders) giúp chúng ta trích xuất giá trị từ URI của request và sử dụng chúng làm tham số trong mẫu route.
- Các tokens được đặt trong dấu ngoặc vuông [] và có thể được đặt trong mẫu route để trích xuất các phần cụ thể của URI.
- Những giá trị được trích xuất này sau đó có thể được sử dụng làm tham số trong các phương thức action của bạn. 
- Dưới đây là một số tokens tiêu chuẩn thường được sử dụng trong định tuyến thuộc tính:
  [controller]: Đại diện cho tên của controller.
  [action]: Đại diện cho tên của phương thức action.
 
-- Route Prefix in ASP.NET Core Web API Routing --
- Trong ASP.NET Core Web API, tiền tố route (route prefix) định nghĩa một đoạn đường dẫn chung được bao gồm trong URL của tất cả các action trong một controller.
- Điều này có thể đơn giản hóa cấu hình định tuyến bằng cách loại bỏ sự cần thiết phải chỉ định lặp lại các phần route chung trong mỗi action trong controller.

-- How to Define a Route Prefix? --
- Route Prefix thường được định nghĩa bằng thuộc tính [Route] ở cấp độ controller. Thuộc tính này xác định đoạn URI ban đầu sẽ chung cho tất cả các action trong controller đó.

-- Route Prefix in ASP.NET Core Web API Attribute Routing --
1. Tổ chức API rõ ràng: Bằng cách nhóm tất cả các action trong controller dưới một route prefix chung, chúng ta làm rõ cấu trúc API, đặc biệt hữu ích trong các dự án lớn với nhiều controller.
2. Giảm dư thừa: Thay vì định nghĩa đường dẫn đầy đủ cho mỗi action, bạn chỉ cần chỉ định phần route duy nhất cho action đó, giúp giảm sự dư thừa và không nhất quán trong các đường dẫn route.
3. Dễ bảo trì: Thay đổi route prefix ở controller sẽ tự động áp dụng cho tất cả các action, giúp việc bảo trì trở nên dễ dàng hơn.

-- ASP.NET Core Web API Attribute Routing with Route Constraints --
- Ràng buộc route (Route Constraints) trong ASP.NET Core Web API được sử dụng để hạn chế các yêu cầu HTTP có thể khớp với một route cụ thể. 
- Chúng cho phép API đảm bảo rằng các tham số của route thuộc một kiểu, phạm vi hoặc mẫu nhất định, điều này có thể rất quan trọng cho logic và bảo mật của API. 
- Việc triển khai ràng buộc route hiệu quả có thể dẫn đến các ứng dụng mạnh mẽ và ít lỗi hơn.
- Ràng buộc Route trong Định Tuyến thuộc tính ASP.NET Core Web API thực chất là một tập hợp các quy tắc có thể áp dụng cho các tham số định tuyến để hạn chế cách các tham số trong mẫu route được khớp. 
- Cú pháp sử dụng Ràng buộc Route là: {parameter:constraint}
- Các loại ràng buộc route thông dụng:
  1. :int - Chỉ khớp số nguyên
  2. :alpha - Chỉ khớp chữ cái
  3. :regex - Khớp biểu thức chính quy
  4. :minlength(n) - Độ dài tối thiểu
  5. :maxlength(n) - Độ dài tối đa
  6. :range(min,max) - Phạm vi giá trị

-- Advantages of Using Route Constraints in ASP.NET Core Web API --
1. Validation at Routing Level: Ràng buộc định tuyến kiểm tra tính hợp lệ của request trước khi nó đến phương thức action, giúp giảm xử lý không cần thiết cho các request không hợp lệ.
2. Improved Security: Bằng cách đảm bảo chỉ các request có tham số đúng định dạng mới được xử lý, ràng buộc định tuyến giúp ngăn chặn một số loại tấn công.
3. Improved URL Matching: Bằng cách xác định tiêu chí chính xác cho các tham số route, ràng buộc giúp đảm bảo các URL được định tuyến đến đúng action tương ứng.